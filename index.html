<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo — Trading Bot & Wallet (MVP)</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa8bd;
      --accent:#6ee7b7;
      --accent-2:#60a5fa;
      --danger:#fb7185;
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071124 0%, #041026 100%);color:#e6eef6}
    .app {max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:320px 1fr;gap:20px;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow: 0 4px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    header.card{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#022;box-shadow:0 6px 20px rgba(96,165,250,0.08)}
    h1{margin:0;font-size:18px}
    .muted{color:var(--muted);font-size:13px}

    /* left column */
    .left{display:flex;flex-direction:column;gap:16px}
    .balance{font-size:22px;font-weight:700}
    .mini{display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(180deg,#142233,#0e2736);padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--accent);font-weight:600}
    .btn.secondary{background:transparent;border:1px dashed rgba(255,255,255,0.04);color:var(--muted);font-weight:600}
    .wallet-list{display:flex;flex-direction:column;gap:10px}
    .wallet-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:var(--glass-2);font-size:13px}
    .small{font-size:12px;color:var(--muted)}
    .addr{font-family:monospace;font-size:12px;color:#bfeadf;word-break:break-all}

    /* right column */
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
    .panel{min-height:160px}
    .chart-wrap{height:300px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.008))}
    canvas{width:100%;height:100%;display:block;border-radius:8px}

    .tariffs{display:flex;flex-direction:column;gap:12px}
    .tariff{display:flex;flex-direction:column;padding:14px;border-radius:10px;background:linear-gradient(180deg,#07182a,#061422);border:1px solid rgba(255,255,255,0.02)}
    .tariff h3{margin:0;font-size:16px}
    .tariff .price{font-size:20px;font-weight:800;color:var(--accent)}
    .controls{display:flex;gap:8px;align-items:center}

    .transactions{display:flex;flex-direction:column;gap:8px;max-height:240px;overflow:auto;padding-right:6px}
    .tx{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass);font-size:13px}
    .tag{padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted)}

    /* forms & modal */
    .form-row{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
    input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit;font-size:14px}
    label{font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center;margin-top:10px}

    /* responsive */
    @media (max-width:1100px){.app{grid-template-columns:1fr;}.grid{grid-template-columns:1fr}.left{order:2}}
    footer{grid-column:1/-1;margin-top:8px;text-align:center;color:var(--muted);font-size:13px}
    .admin-toggle{display:flex;align-items:center;gap:8px}
  </style>
</head>
<body>
  <div class="app">
    <header class="card">
      <div class="brand">
        <div class="logo">B</div>
        <div>
          <h1>BoostEx — Trading Bot & Wallet (Demo)</h1>
          <div class="muted">Demo UI · симуляция · не хранит приватные ключи (локально)</div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <div class="admin-toggle small">
          <label class="small">Admin mode</label>
          <input id="adminChk" type="checkbox" />
        </div>
        <button class="btn" id="btnTelegram">Войти через Telegram</button>
        <button class="btn secondary" id="btnRegister">Регистрация (Email)</button>
      </div>
    </header>

    <!-- LEFT -->
    <aside class="left">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Баланс в кошельке</div>
            <div class="balance" id="totalBalance">—</div>
            <div class="small">USD эквивалент (симуляция)</div>
          </div>
          <div style="text-align:right">
            <div class="mini">
              <button class="btn" id="btnDeposit">Пополнить</button>
              <button class="btn secondary" id="btnConvert">Конвертировать</button>
            </div>
            <div style="height:8px"></div>
            <div class="small">Профит бота: <span id="botPnl">—</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div class="small">Мои адреса</div>
          <button class="btn secondary" id="btnNewAddress">Новый адрес</button>
        </div>
        <div class="wallet-list" id="walletList">
          <!-- addresses inserted by JS -->
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Текущая подписка</div>
            <div id="activePlan" style="font-weight:700">Нет подписки</div>
          </div>
          <div>
            <button class="btn" id="btnPlans">Тарифы</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- RIGHT -->
    <main>
      <div class="grid">
        <section class="card panel">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <div class="small">Trading Bot · ИИ-симуляция</div>
              <div style="font-weight:700">Автоматическая торговля (демо)</div>
            </div>
            <div class="controls">
              <button class="btn" id="btnStartBot">Запустить</button>
              <button class="btn secondary" id="btnStopBot">Остановить</button>
              <button class="btn" id="btnResetBot">Сбросить</button>
            </div>
          </div>

          <div class="chart-wrap">
            <canvas id="botChart"></canvas>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
            <div class="small">Стратегии: mean-revert · momentum · hybrid (симуляция)</div>
            <div class="small">Время: <span id="botTime">00:00</span></div>
          </div>
        </section>

        <aside class="card panel">
          <div style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
            <div class="small">Тарифы и планы</div>
            <div class="small">Выбери подходящий</div>
          </div>
          <div class="tariffs" id="tariffs">
            <!-- tariffs inserted by JS -->
          </div>
        </aside>

        <section class="card panel" style="grid-column:1/-1;margin-top:10px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <div class="small">История транзакций</div>
              <div style="font-weight:700">Последние операции</div>
            </div>
            <div>
              <button class="btn secondary" id="btnExport">Экспорт</button>
            </div>
          </div>

          <div class="transactions" id="txList">
            <!-- tx inserted by JS -->
          </div>
        </section>
      </div>
    </main>

    <footer class="muted card" style="display:flex;justify-content:space-between;align-items:center">
      <div>BoostEx Demo · интерфейс для MVP · не хранит приватные ключи (в демо)</div>
      <div>Need production integration? Email: team@boostex.example</div>
    </footer>
  </div>

  <!-- MODALS (simple) -->
  <div id="modalRoot" style="position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;z-index:9999">
    <div id="modalBg" style="position:absolute;left:0;top:0;width:100%;height:100%;background:linear-gradient(180deg,rgba(0,0,0,0.6),rgba(0,0,0,0.6))"></div>
    <div id="modal" style="position:relative;z-index:10;max-width:760px;width:94%;border-radius:12px;padding:18px;background:linear-gradient(180deg,#041022,#071827);border:1px solid rgba(255,255,255,0.03)">
      <!-- dynamic content -->
    </div>
  </div>

  <script>
    /************************************************************************
     * Demo front-end application logic
     * - All data is simulated in-browser
     * - Comments mark where to integrate real backend endpoints
     *
     * Replace simulated calls with real fetch(...) to your API:
     * - /auth/register, /auth/login
     * - /wallets (create/list), /tx/prepare, /tx/broadcast
     * - /plans/subscribe
     * - Admin endpoints for withdraws
     *
     * SECURITY NOTE: For production, use secure auth (SRP/WebAuthn/etc),
     * store keys in HSM/KMS, separate hot/cold wallets, implement KYT/KYC.
     ************************************************************************/

    /* ---------- Demo state ---------- */
    const state = {
      user: null,
      wallets: [],
      txs: [],
      balance: { USDT: 1250.50, USD: 1250.50 }, // demo balances
      bot: { running: false, points: [], pnl: 0, time: 0, base: 1000 },
      plans: [
        { id: 'starter', title: 'Starter', price: '99 €', durationDays: 30, yield: '25%/мес', desc: 'Демо-план для теста', min: 100 },
        { id: 'pro', title: 'Pro', price: '299 €', durationDays: 60, yield: '35%/мес', desc: 'Для активных', min: 500 },
        { id: 'vip', title: 'VIP', price: '999 €', durationDays: 90, yield: '45%/мес', desc: 'Максимальная доходность', min: 2000 }
      ],
      isAdmin: false
    };

    /* ---------- Helpers ---------- */
    function uid(len=8){return Math.random().toString(36).slice(2,2+len)}
    function fmt(n){return (Math.round(n*100)/100).toLocaleString('ru-RU')}
    function nowTime(){const d=new Date(); return d.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit',second:'2-digit'})}

    /* ---------- Render initial UI ---------- */
    const totalBalanceEl = document.getElementById('totalBalance')
    const walletListEl = document.getElementById('walletList')
    const txListEl = document.getElementById('txList')
    const tariffsEl = document.getElementById('tariffs')
    const botPnlEl = document.getElementById('botPnl')
    const botTimeEl = document.getElementById('botTime')
    const activePlanEl = document.getElementById('activePlan')

    function renderBalance(){ totalBalanceEl.textContent = `${fmt(state.balance.USDT)} USDT` }
    function renderWallets(){
      walletListEl.innerHTML=''
      state.wallets.forEach(w=>{
        const div=document.createElement('div'); div.className='wallet-item'
        div.innerHTML = `<div style="flex:1"><div class="small">${w.coin} · ${w.network}</div><div class="addr">${w.address}</div></div>
                         <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
                           <button class="btn secondary" data-addr="${w.address}" onclick="copyAddr(event)">Копировать</button>
                           <button class="btn" data-addr="${w.address}" onclick="openDeposit(event)">Пополнить</button>
                         </div>`
        walletListEl.appendChild(div)
      })
      if(state.wallets.length===0){
        walletListEl.innerHTML = `<div class="small muted">Пока нет адресов — нажмите «Новый адрес» для генерации (симуляция)</div>`
      }
    }
    function renderTx(){
      txListEl.innerHTML=''
      state.txs.slice().reverse().forEach(t=>{
        const div=document.createElement('div'); div.className='tx'
        div.innerHTML=`<div><div style="font-weight:700">${t.type} · ${t.amount} ${t.coin}</div><div class="small">${t.note}</div></div>
                       <div style="text-align:right"><div class="small">${t.time}</div><div class="tag">${t.status}</div></div>`
        txListEl.appendChild(div)
      })
      if(state.txs.length===0) txListEl.innerHTML = `<div class="small muted">Нет транзакций</div>`
    }
    function renderTariffs(){
      tariffsEl.innerHTML=''
      state.plans.forEach(p=>{
        const div=document.createElement('div'); div.className='tariff'
        div.innerHTML = `<h3>${p.title}</h3><div class="price">${p.price}</div><div class="small">${p.yield} · ${p.durationDays} дней</div><div style="margin-top:8px">${p.desc}</div>
                         <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
                           <div class="small">Мин. вход: ${p.min} €</div>
                           <div><button class="btn" data-id="${p.id}" onclick="subscribePlan(event)">Подписаться</button></div>
                         </div>`
        tariffsEl.appendChild(div)
      })
    }

    /* ---------- Wallet & Tx simulation ---------- */
    function createAddress(coin='USDT', network='TRC-20'){
      // In production: POST /wallets -> returns real address + deposit memo if needed
      const address = (network==='TRC-20' ? 'T' : (network==='ERC-20'?'0x':'X')) + uid(28)
      const w = { id: uid(6), coin, network, address }
      state.wallets.push(w); renderWallets()
      addTx({type:'address', amount:'—', coin, note:`Address created (${network})`, status:'ok'})
      return w
    }
    function addTx(tx){ tx.id = uid(6); tx.time = nowTime(); state.txs.push(tx); renderTx() }

    /* ---------- Deposit modal ---------- */
    function openDeposit(e){
      const addr = e.currentTarget.dataset.addr
      showModal(`<h2>Пополнение</h2>
        <div class="small">Адрес для пополнения (скопируйте в кошелёк отправителя)</div>
        <pre style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;margin-top:8px;font-family:monospace">${addr}</pre>
        <div class="small" style="margin-top:8px">Примечание: это демонстрационный адрес. В проде используйте реальные deposit-адреса/мержинг.</div>
        <div style="display:flex;gap:8px;margin-top:12px"><button class="btn" onclick="modalClose()">Закрыть</button></div>`)
    }

    function copyAddr(e){
      const addr = e.currentTarget.dataset.addr
      navigator.clipboard?.writeText(addr).then(()=>alert('Адрес скопирован в буфер обмена (демо)'))
    }

    /* ---------- Convert (internal) ---------- */
    document.getElementById('btnConvert').addEventListener('click',()=>{
      showModal(`<h2>Конвертация валют</h2>
        <div class="form-row"><label>От</label><select id="fromCoin"><option>USDT</option><option>USDC</option><option>ETH</option></select></div>
        <div class="form-row"><label>Кому</label><select id="toCoin"><option>USDT</option><option>USDC</option><option>ETH</option></select></div>
        <div class="form-row"><label>Сумма</label><input id="convAmount" type="number" value="100" /></div>
        <div class="actions"><button class="btn" onclick="doConvert()">Конвертировать</button><button class="btn secondary" onclick="modalClose()">Отмена</button></div>`)
    })
    function doConvert(){
      const from = document.getElementById('fromCoin').value
      const to = document.getElementById('toCoin').value
      let amount = Number(document.getElementById('convAmount').value) || 0
      if(from===to){ alert('Нельзя конвертировать в ту же валюту'); return }
      // simple demo: fee 0.5%
      const fee = amount * 0.005
      amount = amount - fee
      // update demo balance only for USDT
      if(from==='USDT'){ state.balance.USDT -= (Number(document.getElementById('convAmount').value) || 0) }
      if(to==='USDT'){ state.balance.USDT += amount }
      renderBalance(); addTx({type:'convert', coin:to, amount:fmt(amount), note:`Converted from ${from} (fee ${fmt(fee)})`, status:'ok'})
      modalClose()
    }

    /* ---------- Tariff subscription ---------- */
    function subscribePlan(e){
      const id = e.currentTarget.dataset.id
      const plan = state.plans.find(p=>p.id===id)
      if(!plan) return
      showModal(`<h2>Подписка: ${plan.title}</h2>
        <div class="small">Мин. вход: ${plan.min} € · ${plan.yield}</div>
        <div class="form-row"><label>Сумма (€)</label><input id="subAmount" type="number" value="${plan.min}" /></div>
        <div class="actions">
          <button class="btn" onclick="confirmSubscribe('${id}')">Подтвердить</button>
          <button class="btn secondary" onclick="modalClose()">Отмена</button>
        </div>`)
    }
    function confirmSubscribe(id){
      const amount = Number(document.getElementById('subAmount').value) || 0
      const plan = state.plans.find(p=>p.id===id)
      if(amount < plan.min){ alert('Сумма ниже минимума'); return }
      // In production: POST /plans/subscribe -> returns subscription, locks funds, schedule payouts
      activePlanEl.textContent = `${plan.title} · ${plan.yield}`
      addTx({type:'subscribe', coin:'EUR', amount:amount, note:`Subscribed to ${plan.title}`, status:'pending'})
      modalClose()
    }

    /* ---------- Registration / Telegram (demo) ---------- */
    document.getElementById('btnRegister').addEventListener('click', ()=>{
      showModal(`<h2>Регистрация</h2>
        <div class="form-row"><label>Email</label><input id="regEmail" type="email" /></div>
        <div class="form-row"><label>Пароль</label><input id="regPass" type="password" /></div>
        <div class="actions"><button class="btn" onclick="doRegister()">Зарегистрироваться</button><button class="btn secondary" onclick="modalClose()">Отмена</button></div>`)
    })
    function doRegister(){
      const email = document.getElementById('regEmail').value
      if(!email) { alert('Введите email'); return }
      // In production: POST /auth/register -> returns token
      state.user = { id: uid(6), email, name: email.split('@')[0] }
      addTx({type:'account', amount:'—', coin:'—', note:`User registered (${email})`, status:'ok'})
      modalClose(); syncUI()
    }
    document.getElementById('btnTelegram').addEventListener('click', ()=>{
      // In production: integrate Telegram Passport / Telegram login widget
      state.user = { id: uid(6), name: 'tg_user_' + uid(4), via: 'telegram' }
      addTx({type:'account', amount:'—', coin:'—', note:`Logged in via Telegram`, status:'ok'})
      syncUI()
    })

    /* ---------- Admin withdraw (demo) ---------- */
    document.getElementById('adminChk').addEventListener('change', (e)=>{
      state.isAdmin = e.target.checked
      syncUI()
    })

    function openAdminWithdraw(){
      // In production: protected admin endpoint, MFA, approval flow, audit logs
      showModal(`<h2>Admin Withdraw</h2>
        <div class="form-row"><label>Сеть</label><select id="awNet"><option>TRC-20</option><option>ERC-20</option></select></div>
        <div class="form-row"><label>Монета</label><select id="awCoin"><option>USDT</option></select></div>
        <div class="form-row"><label>Адрес вывода</label><input id="awAddr" type="text" value="T_dest_..." /></div>
        <div class="form-row"><label>Сумма</label><input id="awAmt" type="number" value="100" /></div>
        <div class="actions"><button class="btn" onclick="doAdminWithdraw()">Выполнить</button><button class="btn secondary" onclick="modalClose()">Отмена</button></div>`)
    }
    function doAdminWithdraw(){
      const addr = document.getElementById('awAddr').value
      const amt = Number(document.getElementById('awAmt').value)||0
      addTx({type:'withdraw', amount:amt, coin:'USDT', note:`Admin withdraw to ${addr}`, status:'ok'})
      state.balance.USDT -= amt
      renderBalance(); modalClose()
    }

    /* ---------- Modal helpers ---------- */
    function showModal(html){
      document.getElementById('modalRoot').style.display = 'flex'
      document.getElementById('modal').innerHTML = html
    }
    function modalClose(){ document.getElementById('modalRoot').style.display='none'; document.getElementById('modal').innerHTML='' }

    /* ---------- Chart / Bot simulation ---------- */
    const canvas = document.getElementById('botChart')
    const ctx = canvas.getContext('2d')
    let DPR = window.devicePixelRatio || 1
    function resizeCanvas(){
      canvas.width = canvas.clientWidth * DPR
      canvas.height = canvas.clientHeight * DPR
      drawChart()
    }
    window.addEventListener('resize', resizeCanvas)

    function drawChart(){
      ctx.clearRect(0,0,canvas.width,canvas.height)
      // background grid
      ctx.save()
      ctx.scale(DPR,DPR)
      ctx.fillStyle = 'rgba(255,255,255,0.02)'
      ctx.fillRect(0,0,canvas.clientWidth,canvas.clientHeight)
      // axes
      const w = canvas.clientWidth, h = canvas.clientHeight
      // draw line
      const pts = state.bot.points.length ? state.bot.points : Array.from({length:50},(_,i)=>1000 + Math.sin(i/5)*30 + Math.random()*10)
      const min = Math.min(...pts), max = Math.max(...pts)
      const scaleY = (h-30)/(max-min||1)
      ctx.beginPath()
      for(let i=0;i<pts.length;i++){
        const x = 10 + (w-20) * (i/(pts.length-1))
        const y = h - 15 - (pts[i]-min) * scaleY
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y)
      }
      ctx.lineWidth = 2.5
      ctx.strokeStyle = 'rgba(110,231,183,0.95)'
      ctx.stroke()
      // fill
      ctx.lineTo(w-10,h-10)
      ctx.lineTo(10,h-10)
      ctx.closePath()
      ctx.fillStyle = 'rgba(110,231,183,0.06)'
      ctx.fill()
      // current value
      ctx.fillStyle = '#cdefdc'
      ctx.font = '12px Inter, Arial'
      ctx.fillText('Баланс: ' + fmt(state.bot.base + state.bot.pnl) + ' USDT', 12, 16)
      ctx.restore()
    }

    function botTick(){
      if(!state.bot.running) return
      // simple random walk + mean reversion
      const last = state.bot.points.length ? state.bot.points[state.bot.points.length-1] : state.bot.base
      let next = last * (1 + (Math.random()-0.48)/200)
      // occasional drift
      if(Math.random()<0.08) next *= (1 + (Math.random()-0.5)/50)
      state.bot.points.push(next)
      if(state.bot.points.length>120) state.bot.points.shift()
      // simulate pnl: current vs base
      state.bot.pnl = next - state.bot.base
      botPnlEl.textContent = `${fmt(state.bot.pnl)} USDT`
      botTimeEl.textContent = nowTime()
      renderBalance()
      drawChart()
    }

    /* ---------- Controls ---------- */
    document.getElementById('btnStartBot').addEventListener('click',()=>{
      if(state.bot.running) return
      state.bot.running=true
      addTx({type:'bot', amount:'—', coin:'USDT', note:'Bot started', status:'ok'})
      botInterval = setInterval(botTick, 900)
    })
    document.getElementById('btnStopBot').addEventListener('click',()=>{
      state.bot.running=false
      clearInterval(botInterval)
      addTx({type:'bot', amount:'—', coin:'USDT', note:'Bot stopped', status:'ok'})
    })
    document.getElementById('btnResetBot').addEventListener('click',()=>{
      state.bot.points=[]; state.bot.pnl=0; state.bot.base=1000; drawChart()
      addTx({type:'bot', amount:'—', coin:'USDT', note:'Bot reset', status:'ok'})
    })

    document.getElementById('btnNewAddress').addEventListener('click', ()=>createAddress('USDT','TRC-20'))
    document.getElementById('btnDeposit').addEventListener('click', ()=> {
      // open deposit for first wallet or create one
      if(state.wallets.length===0) createAddress()
      openDeposit({currentTarget:{dataset:{addr: state.wallets[0].address}}})
    })
    document.getElementById('btnPlans').addEventListener('click', ()=> showModal(`<h2>Тарифы</h2><div id="planModalInner"></div><div style="margin-top:12px;display:flex;gap:8px"><button class="btn" onclick="modalClose()">Закрыть</button></div>`), setTimeout(()=>document.getElementById('planModalInner').appendChild(tariffsEl.cloneNode(true)),50))
    document.getElementById('btnExport').addEventListener('click', ()=> { alert('Экспорт (демо) — скачивание CSV в проде'); })

    /* ---------- Sync UI ---------- */
    function syncUI(){
      renderBalance(); renderWallets(); renderTx(); renderTariffs()
      botPnlEl.textContent = `${fmt(state.bot.pnl)} USDT`
      if(state.user) document.querySelector('.muted').textContent = `Добро пожаловать, ${state.user.name || state.user.email || 'пользователь'}`

      // Show admin withdraw if admin
      if(state.isAdmin){
        const adminBtn = document.createElement('button'); adminBtn.className='btn'; adminBtn.textContent='Admin Withdraw'; adminBtn.onclick=openAdminWithdraw
        if(!document.getElementById('adminBtnInserted')){ document.querySelector('header.card').appendChild(adminBtn); adminBtn.id='adminBtnInserted' }
      } else {
        const ex = document.getElementById('adminBtnInserted'); if(ex) ex.remove()
      }
    }

    /* ---------- Startup ---------- */
    renderBalance(); renderWallets(); renderTx(); renderTariffs(); resizeCanvas()
    // seed demo data
    createAddress('USDT','TRC-20')
    createAddress('USDT','ERC-20')
    addTx({type:'deposit', amount:200, coin:'USDT', note:'Initial demo deposit', status:'ok'})
    let botInterval = null

    /* ---------- Expose some functions for buttons in HTML created via JS ---------- */
    window.copyAddr = copyAddr
    window.openDeposit = openDeposit
    window.subscribePlan = subscribePlan
    window.modalClose = modalClose
    window.doAdminWithdraw = doAdminWithdraw
    window.doConvert = doConvert
    window.confirmSubscribe = confirmSubscribe
    window.createAddress = createAddress
    window.syncUI = syncUI

    // draw once
    drawChart()
  </script>
</body>
</html>
